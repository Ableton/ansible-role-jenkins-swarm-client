---
- name: Update apt cache and remove unused package dependencies
  become: true
  apt:
    autoclean: true
    autoremove: true
    update_cache: true

- name: Install apt dependencies
  become: true
  apt:
    name: "{{ item.key }}"
    state: present
  with_dict: "{{ jenkins_node_packages }}"

- name: Run installation tasks common to Unix-like systems
  include_tasks: "{{ role_path }}/tasks/unix/install.yml"

- name: Install systemd service
  include_tasks: "{{ role_path }}/tasks/debian/install-systemd.yml"
  when: not jenkins_swarm_use_script

- name: Create shell script launcher
  include_tasks: "{{ role_path }}/tasks/unix/install-script.yml"
  when: jenkins_swarm_use_script
